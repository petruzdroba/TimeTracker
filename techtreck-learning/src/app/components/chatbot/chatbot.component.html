<div class="chat-container" [ngClass]="{'popup-mode': isPopup}">

  <div #messageContainer class="messages" (scroll)="onScroll($event)">
    @for (text of history; track text; let i = $index) {
      <div [ngClass]="i % 2 === 0 ? 'bubble bot' : 'bubble user'">
        {{ text }}
      </div>
    }
  </div>

  @if (choices().length) {
    <div class="choices">
      <mat-chip-listbox>
        @for (choice of choices(); track choice.id) {
          <mat-chip-option (click)="select(choice)">
            {{ choice.question }}
          </mat-chip-option>
        }
      </mat-chip-listbox>
    </div>
  }

  @if (!showInput) {
    <div class="input-toggle-container">
      <button mat-stroked-button color="primary" (click)="toggleInput()">
        <mat-icon>chat</mat-icon>
        Type a question
      </button>
    </div>
  }

  @if (showInput) {
    <form [formGroup]="messageForm" (ngSubmit)="onSubmit()" class="message-form" autocomplete="off">
      <mat-form-field appearance="outline" class="message-input">
        <input matInput
               placeholder="Type your question..."
               formControlName="message"
               (keyup.enter)="onSubmit()">
        <button matSuffix
                mat-icon-button
                type="submit"
                [disabled]="!messageForm.valid || !messageForm.value.message?.trim()">
          <mat-icon>send</mat-icon>
        </button>
      </mat-form-field>
    </form>
  }

  <div class="reset-container">
    <button mat-stroked-button color="warn" (click)="reset()">Reset Chat</button>
  </div>

</div>
